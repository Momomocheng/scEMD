<!-- module1.html -->
<div id="module1">
    <h2>数据集处理模块</h2>
    <input type="file" id="fileUpload" />
    <button id="uploadBtn">上传文件</button>

    <!-- 上传进度条 -->
    <div class="progress mt-2" style="display: none;">
        <div id="uploadProgress" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
    </div>

    <div class="row mt-3">
        <div class="col-md-6">
            <img id="uploadedImage1" src="#" alt="expression_distribution_of_genes" style="display:none; width: 100%;" />
        </div>
        <div class="col-md-6">
            <img id="uploadedImage2" src="#" alt="nFeature_RNA" style="display:none; width: 100%;" />
        </div>
        <div class="col-md-12">
            <img id="uploadedImage3" src="#" alt="umap_leiden" style="display:none; width: 100%;" />
        </div>
    </div>
      
</div>

<!-- 引入jQuery库 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    $('#uploadBtn').on('click', function() {
      // 1. 获取上传的文件
      var file = $('#fileUpload')[0].files[0];

      // 2. 使用FormData对象准备发送文件
      var formData = new FormData();
      formData.append('file', file);

      // 3. 创建一个自定义的XMLHttpRequest对象，用于监听上传进度事件
      var xhr = new XMLHttpRequest();

      xhr.upload.addEventListener('progress', function(event) {
        if (event.lengthComputable) {
          var percentComplete = Math.round((event.loaded / event.total) * 100);
          $('#uploadProgress').css('width', percentComplete + '%').attr('aria-valuenow', percentComplete);
          $('.progress').show();
        }
      }, false);

      // 4. 使用jQuery发送Ajax请求，并使用自定义的XMLHttpRequest对象
      $.ajax({
        url: '/upload', // 您的后端上传图片处理的URL
        type: 'POST',
        data: formData,
        contentType: false,
        processData: false,
        xhr: function() {
          return xhr;
        },
        success: function(data) {
          if (data.status === 'success') {
            $('#uploadedImage1').attr('src', data.image_url1).show();
            $('#uploadedImage2').attr('src', data.image_url2).show();
            $('#uploadedImage3').attr('src', data.image_url3).show();
          } else {
            alert('上传失败，请重试');
          }
          $('.progress').hide();
          $('#uploadProgress').css('width', '0%').attr('aria-valuenow', 0);
        },
        error: function() {
          alert('上传失败，请重试');
          $('.progress').hide();
          $('#uploadProgress').css('width', '0%').attr('aria-valuenow', 0);
        }
      });
    });
  });
</script>

